{"author":"Melonport AG <team@melonport.com>","title":"Fund Staked Contract","fileName":"/./src/Staked.sol","name":"Staked","abi":[{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"gav","type":"uint256"},{"name":"unclaimedRewards","type":"uint256"}],"name":"calcNav","outputs":[{"name":"nav","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"shutDown","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantityExpectedToReturn","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getSymbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getName","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getLastRequestId","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantitySentToExchange","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"DIVISOR_FEE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"DECIMALS","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"},{"name":"quantity","type":"uint256"}],"name":"takeOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"cancelRequest","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"atLastConversion","outputs":[{"name":"gav","type":"uint256"},{"name":"managementReward","type":"uint256"},{"name":"performanceReward","type":"uint256"},{"name":"unclaimedRewards","type":"uint256"},{"name":"nav","type":"uint256"},{"name":"sharePrice","type":"uint256"},{"name":"totalSupply","type":"uint256"},{"name":"timestamp","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"cancelOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantityHeldInCustodyOfExchange","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"calcGav","outputs":[{"name":"gav","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"toggleSubscription","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"value","type":"uint256"}],"name":"calcValuePerShare","outputs":[{"name":"valuePerShare","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"toggleRedemption","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getLastOrderId","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"CREATED","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint256"}],"name":"executeRequest","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"MANAGEMENT_REWARD_RATE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"requests","outputs":[{"name":"participant","type":"address"},{"name":"status","type":"uint8"},{"name":"requestType","type":"uint8"},{"name":"shareQuantity","type":"uint256"},{"name":"giveQuantity","type":"uint256"},{"name":"receiveQuantity","type":"uint256"},{"name":"incentiveQuantity","type":"uint256"},{"name":"lastDataFeedUpdateId","type":"uint256"},{"name":"lastDataFeedUpdateTime","type":"uint256"},{"name":"timestamp","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"}],"name":"redeemOwnedAssets","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"convertUnclaimedRewards","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"calcSharePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"openMakeOrderId","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"MELON_ASSET","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address"},{"name":"buyAsset","type":"address"}],"name":"manualSettlement","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"giveQuantity","type":"uint256"},{"name":"shareQuantity","type":"uint256"},{"name":"incentiveQuantity","type":"uint256"}],"name":"requestSubscription","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"NAME","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"performCalculations","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"orders","outputs":[{"name":"exchangeId","type":"uint256"},{"name":"status","type":"uint8"},{"name":"orderType","type":"uint8"},{"name":"sellAsset","type":"address"},{"name":"buyAsset","type":"address"},{"name":"sellQuantity","type":"uint256"},{"name":"buyQuantity","type":"uint256"},{"name":"timestamp","type":"uint256"},{"name":"fillQuantity","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"MELON_IN_BASE_UNITS","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"PERFORMANCE_REWARD_RATE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"gav","type":"uint256"}],"name":"calcUnclaimedRewards","outputs":[{"name":"managementReward","type":"uint256"},{"name":"performanceReward","type":"uint256"},{"name":"unclaimedRewards","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"},{"name":"receiveQuantity","type":"uint256"},{"name":"incentiveQuantity","type":"uint256"}],"name":"requestRedemption","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getModules","outputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"EXCHANGE","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"module","outputs":[{"name":"datafeed","type":"address"},{"name":"exchange","type":"address"},{"name":"participation","type":"address"},{"name":"riskmgmt","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getBaseUnits","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isRedeemAllowed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isSubscribeAllowed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address"},{"name":"buyAsset","type":"address"}],"name":"proofOfEmbezzlement","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"MELON_CONTRACT","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"remaining","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"REFERENCE_ASSET","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getCreationTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address"},{"name":"buyAsset","type":"address"},{"name":"sellQuantity","type":"uint256"},{"name":"buyQuantity","type":"uint256"}],"name":"makeOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"}],"name":"decreaseStake","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"}],"name":"increaseStake","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getDecimals","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getStake","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"isShutDown","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"VERSION","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"anonymous":false,"inputs":[{"indexed":false,"name":"holdings","type":"uint256"},{"indexed":false,"name":"price","type":"uint256"},{"indexed":false,"name":"decimals","type":"uint256"}],"name":"PortfolioContent","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"}],"name":"RequestUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"ofParticipant","type":"address"},{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantity","type":"uint256"}],"name":"Subscribed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"ofParticipant","type":"address"},{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantity","type":"uint256"}],"name":"Redeemed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"onConsigned","type":"address"},{"indexed":false,"name":"ofAsset","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"SpendingApproved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantityConverted","type":"uint256"},{"indexed":false,"name":"unclaimed","type":"uint256"}],"name":"RewardsConverted","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"managementReward","type":"uint256"},{"indexed":false,"name":"performanceReward","type":"uint256"},{"indexed":false,"name":"nav","type":"uint256"},{"indexed":false,"name":"sharePrice","type":"uint256"},{"indexed":false,"name":"totalSupply","type":"uint256"}],"name":"CalculationUpdate","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"}],"name":"OrderUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"ERROR_CODE","type":"uint256"}],"name":"LogError","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"errorMessage","type":"string"}],"name":"ErrorMessage","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Approval","type":"event"}],"bin":"","opcodes":"","source":"pragma solidity ^0.4.11;\n\nimport './Fund.sol';\n\n/// @title Fund Staked Contract\n/// @author Melonport AG <team@melonport.com>\n/// @notice To allow for Melon fund assets to leave the reach of the blockchain\ncontract Staked is Fund {\n\n    struct InternalAccounting {\n        uint numberOfMakeOrders; // Number of potentially unsettled orders\n        mapping (bytes32 => bool) existsMakeOrder; // sha3(sellAsset, buyAsset) to boolean\n        mapping (bytes32 => uint) makeOrderId; // sha3(sellAsset, buyAsset) to order id\n        mapping (address => uint) quantitySentToExchange; // Quantity of asset held in custody of exchange\n        mapping (address => uint) quantityExpectedToReturn; // Quantity expected to receive of asset of what has been sent to exchange\n        mapping (address => uint) holdingsAtLastManualSettlement; // Quantity of asset held in custody of fund at time of manual settlement\n    }\n\n    InternalAccounting internalAccounting; // Accounts for assets not held in custody of fund\n\n    function balancesOfHolderAtLeast(address ofHolder, uint x) internal returns (bool) { return balances[ofHolder] >= x; }\n\n    function increaseStake(uint shareQuantity)\n        external\n        pre_cond(isOwner())\n        pre_cond(notShutDown())\n        pre_cond(isPastZero(shareQuantity))\n        pre_cond(balancesOfHolderAtLeast(msg.sender, shareQuantity))\n        post_cond(prevTotalSupply == totalSupply)\n    {\n        uint prevTotalSupply = totalSupply;\n        subShares(msg.sender, shareQuantity);\n        addShares(this, shareQuantity);\n    }\n\n    function decreaseStake(uint shareQuantity)\n        external\n        pre_cond(isOwner())\n        pre_cond(notShutDown())\n        pre_cond(isPastZero(shareQuantity))\n        pre_cond(balancesOfHolderAtLeast(this, shareQuantity))\n        post_cond(prevTotalSupply == totalSupply)\n    {\n        uint prevTotalSupply = totalSupply;\n        subShares(this, shareQuantity);\n        addShares(msg.sender, shareQuantity);\n    }\n\n    /// @notice Reduce exposure without exchange interaction\n    /// @dev After funds have been sent back to Melon fund, 'settle' them internally\n    /// @param sellAsset Asset (as registred in Asset registrar) to be sold\n    /// @param buyAsset Asset (as registred in Asset registrar) to be bought\n    function manualSettlement(address sellAsset, address buyAsset)\n        returns (bool, string)\n    {\n        bytes32 assetPair = sha3(sellAsset, buyAsset);\n\n        if (internalAccounting.existsMakeOrder[assetPair]) {\n            return logError(\"ERR: Make order for input asset pair not found\");\n        }\n\n        uint id = internalAccounting.makeOrderId[assetPair];\n        Order memory order = orders[id];\n        var (error, ) = proofOfEmbezzlement(order.sellAsset, order.buyAsset);\n\n        if (error) {\n            return logError(\"ERR: Embezzlement has been determined\");\n        }\n\n        // TODO: update order.status = OrderStatus.fullyFilled;\n        // TODO: abstract below into function\n        internalAccounting.existsMakeOrder[assetPair] = false;\n        internalAccounting.quantitySentToExchange[order.sellAsset] = 0;\n        internalAccounting.quantityExpectedToReturn[order.buyAsset] = 0;\n        // Update prev holdings\n        internalAccounting.holdingsAtLastManualSettlement[order.sellAsset] = ERC20(order.sellAsset).balanceOf(this);\n        internalAccounting.holdingsAtLastManualSettlement[order.buyAsset] = ERC20(order.buyAsset).balanceOf(this);\n    }\n\n    function quantitySentToExchange(address ofAsset) constant returns (uint) { return internalAccounting.quantitySentToExchange[ofAsset]; }\n    function quantityExpectedToReturn(address ofAsset) constant returns (uint) { return internalAccounting.quantityExpectedToReturn[ofAsset]; }\n\n    /// @notice Whether embezzlement happened\n    /// @dev Asset pair corresponds to unsettled (== make) order\n    /// @param sellAsset Asset (as registred in Asset registrar) to be sold\n    /// @param buyAsset Asset (as registred in Asset registrar) to be bought\n    /// @return True if embezzled otherwise false\n    function proofOfEmbezzlement(address sellAsset, address buyAsset)\n        returns (bool, string)\n    {\n\n        uint sellAssetHoldExpectations = internalAccounting.holdingsAtLastManualSettlement[sellAsset].sub(quantitySentToExchange(sellAsset));\n        if (sellAssetHoldExpectations > ERC20(sellAsset).balanceOf(this)) {\n            return shutDownAndLogError(\"CRITICAL ERR: Sold more than expected!\");\n        }\n\n        // What is held in custody is less or equal than accounted for sell quantity (good)\n        uint factor = MELON_IN_BASE_UNITS; // Want to receive proportionally as much as sold\n        uint divisor = factor; // To reduce inaccuracy due to rounding errors\n        factor = divisor\n            .mul(internalAccounting.holdingsAtLastManualSettlement[sellAsset].sub(ERC20(sellAsset).balanceOf(this)))\n            .div(quantitySentToExchange(sellAsset));\n        // Revise return expectations, for example in case of partial fill of order\n        uint revisedReturnExpectations = quantityExpectedToReturn(buyAsset).mul(factor).div(divisor);\n        uint buyAssetHoldExpectations = internalAccounting.holdingsAtLastManualSettlement[buyAsset].add(revisedReturnExpectations);\n        if (buyAssetHoldExpectations < ERC20(buyAsset).balanceOf(this)) {\n            return shutDownAndLogError(\"CRITICAL ERR: Received (proportionally) less than expected buy quantity!\");\n        }\n\n        return (false, \"\");\n    }\n}\n","abiDocs":[{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","payable":false,"stateMutability":"nonpayable","type":"function","signature":"approve(address,uint256)","signatureHash":"095ea7b3"},{"constant":true,"inputs":[{"name":"gav","type":"uint256","description":"Gross asset value of this fund denominated in [base unit of melonAsset]"},{"name":"unclaimedRewards","type":"uint256","description":"The sum of both managementReward and performanceReward denominated in [base unit of melonAsset]"}],"name":"calcNav","outputs":[{"name":"nav","type":"uint256","description":"Net asset value denominated in [base unit of melonAsset]"}],"payable":false,"stateMutability":"view","type":"function","return":"nav Net asset value denominated in [base unit of melonAsset]","notice":"Calculates the Net asset value of this fund","signature":"calcNav(uint256,uint256)","signatureHash":"0a47185d"},{"constant":false,"inputs":[],"name":"shutDown","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"shutDown()","signatureHash":"10b9e583"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantityExpectedToReturn","payable":false,"stateMutability":"view","type":"function","signature":"quantityExpectedToReturn(address)","signatureHash":"141e50a1"},{"constant":true,"inputs":[],"name":"getSymbol","payable":false,"stateMutability":"view","type":"function","signature":"getSymbol()","signatureHash":"15070401"},{"constant":true,"inputs":[],"name":"getName","payable":false,"stateMutability":"view","type":"function","signature":"getName()","signatureHash":"17d7de7c"},{"constant":true,"inputs":[],"name":"totalSupply","payable":false,"stateMutability":"view","type":"function","signature":"totalSupply()","signatureHash":"18160ddd"},{"constant":true,"inputs":[],"name":"getLastRequestId","payable":false,"stateMutability":"view","type":"function","signature":"getLastRequestId()","signatureHash":"19c2b4c3"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","payable":false,"stateMutability":"nonpayable","type":"function","signature":"transferFrom(address,address,uint256)","signatureHash":"23b872dd"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantitySentToExchange","payable":false,"stateMutability":"view","type":"function","signature":"quantitySentToExchange(address)","signatureHash":"28f1a938"},{"constant":true,"inputs":[],"name":"DIVISOR_FEE","payable":false,"stateMutability":"view","type":"function","signature":"DIVISOR_FEE()","signatureHash":"2c3482e9"},{"constant":true,"inputs":[],"name":"DECIMALS","payable":false,"stateMutability":"view","type":"function","signature":"DECIMALS()","signatureHash":"2e0f2625"},{"constant":false,"inputs":[{"name":"id","type":"uint256","description":"Active order id"},{"name":"quantity","type":"uint256","description":"Buy quantity of what others are selling on selected Exchange"}],"name":"takeOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"These are orders that are expected to settle immediately","return":"Take an offer on the selected Exchange","notice":"Takes an active order on the selected exchange","signature":"takeOrder(uint256,uint256)","signatureHash":"2eab93cb"},{"constant":false,"inputs":[{"name":"id","type":"uint256","description":"Index of request to be executed"}],"name":"cancelRequest","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","return":"Active subscription or redemption request cancelled","notice":"Cancels active subscription and redemption requests","signature":"cancelRequest(uint256)","signatureHash":"3015394c"},{"constant":true,"inputs":[],"name":"atLastConversion","payable":false,"stateMutability":"view","type":"function","signature":"atLastConversion()","signatureHash":"3c1a839b"},{"constant":false,"inputs":[{"name":"id","type":"uint256","description":"Active order id of this order array with order owner of this contract on selected Exchange"}],"name":"cancelOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Reduce exposure with exchange interaction","return":"Whether order successfully cancelled on selected Exchange","notice":"Cancels orders that were not expected to settle immediately, i.e. makeOrders","signature":"cancelOrder(uint256)","signatureHash":"514fcac7"},{"constant":true,"inputs":[{"name":"ofAsset","type":"address"}],"name":"quantityHeldInCustodyOfExchange","payable":false,"stateMutability":"view","type":"function","signature":"quantityHeldInCustodyOfExchange(address)","signatureHash":"51fd2c69"},{"constant":true,"inputs":[],"name":"calcGav","outputs":[{"name":"gav","type":"uint256","description":"Gross asset value denominated in [base unit of melonAsset]"}],"payable":false,"stateMutability":"view","type":"function","details":"Decimals in assets must be equal to decimals in PriceFeed for all entries in Universe","return":"gav Gross asset value denominated in [base unit of melonAsset]","notice":"Calculates gross asset value of the fund","signature":"calcGav()","signatureHash":"56cff99f"},{"constant":false,"inputs":[],"name":"toggleSubscription","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"toggleSubscription()","signatureHash":"5c7d9e58"},{"constant":true,"inputs":[{"name":"value","type":"uint256"}],"name":"calcValuePerShare","outputs":[{"name":"valuePerShare","type":"uint256","description":"Share price denominated in [base unit of melonAsset * base unit of share / base unit of share] == [base unit of melonAsset]"}],"payable":false,"stateMutability":"view","type":"function","details":"Non-zero share supply; value denominated in [base unit of melonAsset]","return":"valuePerShare Share price denominated in [base unit of melonAsset * base unit of share / base unit of share] == [base unit of melonAsset]","notice":"Calculates the share price of the fund","signature":"calcValuePerShare(uint256)","signatureHash":"634a2d56"},{"constant":false,"inputs":[],"name":"toggleRedemption","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"toggleRedemption()","signatureHash":"63b20fff"},{"constant":true,"inputs":[],"name":"getLastOrderId","payable":false,"stateMutability":"view","type":"function","signature":"getLastOrderId()","signatureHash":"68a52509"},{"constant":true,"inputs":[],"name":"CREATED","payable":false,"stateMutability":"view","type":"function","signature":"CREATED()","signatureHash":"697e0ef2"},{"constant":false,"inputs":[{"name":"id","type":"uint256","description":"Index of request to be executed"}],"name":"executeRequest","payable":false,"stateMutability":"nonpayable","type":"function","details":"Distributes melon and shares according to the requestActive subscription or redemption request executed","notice":"Executes active subscription and redemption requests, in a way that minimises information advantages of investor","signature":"executeRequest(uint256)","signatureHash":"6e417c69"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","payable":false,"stateMutability":"view","type":"function","signature":"balanceOf(address)","signatureHash":"70a08231"},{"constant":true,"inputs":[],"name":"MANAGEMENT_REWARD_RATE","payable":false,"stateMutability":"view","type":"function","signature":"MANAGEMENT_REWARD_RATE()","signatureHash":"80c78643"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"requests","payable":false,"stateMutability":"view","type":"function","signature":"requests(uint256)","signatureHash":"81d12c58"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256","description":"Number of shares owned by the participant, which the participant would like to redeem for individual assets"}],"name":"redeemOwnedAssets","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Independent of running price feed! Contains evil for loop, module.datafeed.numRegisteredAssets() needs to be limited","return":"Transfer percentage of all assets from Fund to Investor and annihilate shareQuantity of shares.","notice":"Redeems by allocating an ownership percentage of each asset to the participant","signature":"redeemOwnedAssets(uint256)","signatureHash":"82478871"},{"constant":false,"inputs":[],"name":"convertUnclaimedRewards","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Only Owner","return":"Unclaimed fees of the manager are converted into fund shares with manager as the owner","notice":"Converts unclaimed fees of the manager into fund shares","signature":"convertUnclaimedRewards()","signatureHash":"8a3a8718"},{"constant":true,"inputs":[],"name":"owner","payable":false,"stateMutability":"view","type":"function","signature":"owner()","signatureHash":"8da5cb5b"},{"constant":true,"inputs":[],"name":"calcSharePrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","return":"sharePrice Share price denominated in [base unit of melonAsset]","notice":"Calculates sharePrice denominated in [base unit of melonAsset]","signature":"calcSharePrice()","signatureHash":"9489fa84"},{"constant":true,"inputs":[],"name":"openMakeOrderId","payable":false,"stateMutability":"view","type":"function","signature":"openMakeOrderId()","signatureHash":"95eca6c0"},{"constant":true,"inputs":[],"name":"MELON_ASSET","payable":false,"stateMutability":"view","type":"function","signature":"MELON_ASSET()","signatureHash":"9878cc51"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address","description":"Asset (as registred in Asset registrar) to be sold"},{"name":"buyAsset","type":"address","description":"Asset (as registred in Asset registrar) to be bought"}],"name":"manualSettlement","payable":false,"stateMutability":"nonpayable","type":"function","details":"After funds have been sent back to Melon fund, 'settle' them internally","notice":"Reduce exposure without exchange interaction","signature":"manualSettlement(address,address)","signatureHash":"9b8b3023"},{"constant":false,"inputs":[{"name":"giveQuantity","type":"uint256","description":"Quantity of Melon token times 10 ** 18 offered to receive shareQuantity"},{"name":"shareQuantity","type":"uint256","description":"Quantity of shares times 10 ** 18 requested to be received"},{"name":"incentiveQuantity","type":"uint256","description":"Quantity in Melon asset to give to the person executing the request"}],"name":"requestSubscription","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Recommended to give some leeway in prices to account for possibly slightly changing prices","return":"Active subscription request","notice":"Give melon tokens to receive shares of this fund","signature":"requestSubscription(uint256,uint256,uint256)","signatureHash":"9f92caeb"},{"constant":true,"inputs":[],"name":"NAME","payable":false,"stateMutability":"view","type":"function","signature":"NAME()","signatureHash":"a3f4df7e"},{"constant":true,"inputs":[],"name":"performCalculations","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","return":"{ \"gav\": \"Gross asset value of this fund denominated in [base unit of melonAsset]\", \"managementReward\": \"A time (seconds) based reward\", \"performanceReward\": \"A performance (rise of sharePrice measured in REFERENCE_ASSET) based reward\", \"unclaimedRewards\": \"The sum of both managementReward and performanceReward denominated in [base unit of melonAsset]\", \"nav\": \"Net asset value denominated in [base unit of melonAsset]\", \"sharePrice\": \"Share price denominated in [base unit of melonAsset]\" }","signature":"performCalculations()","signatureHash":"a759822b"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"orders","payable":false,"stateMutability":"view","type":"function","signature":"orders(uint256)","signatureHash":"a85c38ef"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","payable":false,"stateMutability":"nonpayable","type":"function","signature":"transfer(address,uint256)","signatureHash":"a9059cbb"},{"constant":true,"inputs":[],"name":"MELON_IN_BASE_UNITS","payable":false,"stateMutability":"view","type":"function","signature":"MELON_IN_BASE_UNITS()","signatureHash":"ae3a2d45"},{"constant":true,"inputs":[],"name":"PERFORMANCE_REWARD_RATE","payable":false,"stateMutability":"view","type":"function","signature":"PERFORMANCE_REWARD_RATE()","signatureHash":"ae4d704a"},{"constant":true,"inputs":[{"name":"gav","type":"uint256"}],"name":"calcUnclaimedRewards","outputs":[{"name":"managementReward","type":"uint256","description":"A time (seconds) based reward"},{"name":"performanceReward","type":"uint256","description":"A performance (rise of sharePrice measured in REFERENCE_ASSET) based reward"},{"name":"unclaimedRewards","type":"uint256","description":"The sum of both managementReward and performanceReward denominated in [base unit of melonAsset]"}],"payable":false,"stateMutability":"view","type":"function","return":"{ \"managementReward\": \"A time (seconds) based reward\", \"performanceReward\": \"A performance (rise of sharePrice measured in REFERENCE_ASSET) based reward\", \"unclaimedRewards\": \"The sum of both managementReward and performanceReward denominated in [base unit of melonAsset]\" }","signature":"calcUnclaimedRewards(uint256)","signatureHash":"aeefc626"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256","description":"Quantity of shares times 10 ** 18 offered to redeem"},{"name":"receiveQuantity","type":"uint256","description":"Quantity of Melon token times 10 ** 18 requested to receive for shareQuantity"},{"name":"incentiveQuantity","type":"uint256","description":"Quantity in Melon asset to give to the person executing the request"}],"name":"requestRedemption","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Recommended to give some leeway in prices to account for possibly slightly changing prices","return":"Active redemption request","notice":"Give shares of this fund to receive melon tokens","signature":"requestRedemption(uint256,uint256,uint256)","signatureHash":"b1fb80b3"},{"constant":true,"inputs":[],"name":"getModules","payable":false,"stateMutability":"view","type":"function","signature":"getModules()","signatureHash":"b2494df3"},{"constant":true,"inputs":[],"name":"EXCHANGE","payable":false,"stateMutability":"view","type":"function","signature":"EXCHANGE()","signatureHash":"b50e44b8"},{"constant":true,"inputs":[],"name":"module","payable":false,"stateMutability":"view","type":"function","signature":"module()","signatureHash":"b86d5298"},{"constant":true,"inputs":[],"name":"getBaseUnits","payable":false,"stateMutability":"view","type":"function","signature":"getBaseUnits()","signatureHash":"be65fd99"},{"constant":true,"inputs":[],"name":"isRedeemAllowed","payable":false,"stateMutability":"view","type":"function","signature":"isRedeemAllowed()","signatureHash":"c00c2ceb"},{"constant":true,"inputs":[],"name":"isSubscribeAllowed","payable":false,"stateMutability":"view","type":"function","signature":"isSubscribeAllowed()","signatureHash":"c8460315"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address","description":"Asset (as registred in Asset registrar) to be sold"},{"name":"buyAsset","type":"address","description":"Asset (as registred in Asset registrar) to be bought"}],"name":"proofOfEmbezzlement","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"Asset pair corresponds to unsettled (== make) order","return":"True if embezzled otherwise false","notice":"Whether embezzlement happened","signature":"proofOfEmbezzlement(address,address)","signatureHash":"cc704221"},{"constant":true,"inputs":[],"name":"MELON_CONTRACT","payable":false,"stateMutability":"view","type":"function","signature":"MELON_CONTRACT()","signatureHash":"d94a75bc"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","payable":false,"stateMutability":"view","type":"function","signature":"allowance(address,address)","signatureHash":"dd62ed3e"},{"constant":true,"inputs":[],"name":"REFERENCE_ASSET","payable":false,"stateMutability":"view","type":"function","signature":"REFERENCE_ASSET()","signatureHash":"ded4a6fe"},{"constant":true,"inputs":[],"name":"getCreationTime","payable":false,"stateMutability":"view","type":"function","signature":"getCreationTime()","signatureHash":"e6519a35"},{"constant":false,"inputs":[{"name":"sellAsset","type":"address","description":"Asset (as registered in Asset registrar) to be sold"},{"name":"buyAsset","type":"address","description":"Asset (as registered in Asset registrar) to be bought"},{"name":"sellQuantity","type":"uint256","description":"Quantity of sellAsset to be sold"},{"name":"buyQuantity","type":"uint256","description":"Quantity of buyAsset to be bought"}],"name":"makeOrder","outputs":[{"name":"","type":"bool"},{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function","details":"These are orders that are not expected to settle immediately.  Sufficient balance (== sellQuantity) of sellAsset","return":"Make an offer on the selected exchange","notice":"Makes an order on the selected exchange","signature":"makeOrder(address,address,uint256,uint256)","signatureHash":"e68fb207"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"}],"name":"decreaseStake","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"decreaseStake(uint256)","signatureHash":"e8b96de1"},{"constant":false,"inputs":[{"name":"shareQuantity","type":"uint256"}],"name":"increaseStake","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"increaseStake(uint256)","signatureHash":"eedad66b"},{"constant":true,"inputs":[],"name":"getDecimals","payable":false,"stateMutability":"view","type":"function","signature":"getDecimals()","signatureHash":"f0141d84"},{"constant":true,"inputs":[],"name":"getStake","payable":false,"stateMutability":"view","type":"function","signature":"getStake()","signatureHash":"fc0e3d90"},{"constant":true,"inputs":[],"name":"isShutDown","payable":false,"stateMutability":"view","type":"function","signature":"isShutDown()","signatureHash":"ff947525"},{"constant":true,"inputs":[],"name":"VERSION","payable":false,"stateMutability":"view","type":"function","signature":"VERSION()","signatureHash":"ffa1ad74"},{"anonymous":false,"inputs":[{"indexed":false,"name":"holdings","type":"uint256"},{"indexed":false,"name":"price","type":"uint256"},{"indexed":false,"name":"decimals","type":"uint256"}],"name":"PortfolioContent","type":"event","signature":"PortfolioContent(uint256,uint256,uint256)","signatureHash":"5fd357fc"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"}],"name":"RequestUpdated","type":"event","signature":"RequestUpdated(uint256)","signatureHash":"6a3c7945"},{"anonymous":false,"inputs":[{"indexed":true,"name":"ofParticipant","type":"address"},{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantity","type":"uint256"}],"name":"Subscribed","type":"event","signature":"Subscribed(address,uint256,uint256)","signatureHash":"f94991dc"},{"anonymous":false,"inputs":[{"indexed":true,"name":"ofParticipant","type":"address"},{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantity","type":"uint256"}],"name":"Redeemed","type":"event","signature":"Redeemed(address,uint256,uint256)","signatureHash":"f3a670cd"},{"anonymous":false,"inputs":[{"indexed":false,"name":"onConsigned","type":"address"},{"indexed":false,"name":"ofAsset","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"SpendingApproved","type":"event","signature":"SpendingApproved(address,address,uint256)","signatureHash":"18df11ee"},{"anonymous":false,"inputs":[{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"shareQuantityConverted","type":"uint256"},{"indexed":false,"name":"unclaimed","type":"uint256"}],"name":"RewardsConverted","type":"event","signature":"RewardsConverted(uint256,uint256,uint256)","signatureHash":"ff956ac1"},{"anonymous":false,"inputs":[{"indexed":false,"name":"atTimestamp","type":"uint256"},{"indexed":false,"name":"managementReward","type":"uint256"},{"indexed":false,"name":"performanceReward","type":"uint256"},{"indexed":false,"name":"nav","type":"uint256"},{"indexed":false,"name":"sharePrice","type":"uint256"},{"indexed":false,"name":"totalSupply","type":"uint256"}],"name":"CalculationUpdate","type":"event","signature":"CalculationUpdate(uint256,uint256,uint256,uint256,uint256,uint256)","signatureHash":"edd8dd89"},{"anonymous":false,"inputs":[{"indexed":false,"name":"id","type":"uint256"}],"name":"OrderUpdated","type":"event","signature":"OrderUpdated(uint256)","signatureHash":"b8b459bc"},{"anonymous":false,"inputs":[{"indexed":false,"name":"ERROR_CODE","type":"uint256"}],"name":"LogError","type":"event","signature":"LogError(uint256)","signatureHash":"15aca0c4"},{"anonymous":false,"inputs":[{"indexed":false,"name":"errorMessage","type":"string"}],"name":"ErrorMessage","type":"event","signature":"ErrorMessage(string)","signatureHash":"a183e9a5"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_from","type":"address"},{"indexed":true,"name":"_to","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Transfer","type":"event","signature":"Transfer(address,address,uint256)","signatureHash":"ddf252ad"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Approval","type":"event","signature":"Approval(address,address,uint256)","signatureHash":"8c5be1e5"}]}
